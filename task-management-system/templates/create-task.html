<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Task</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Create New Task</h1>
      <form id="create-task-form">
        <div class="form-group">
          <label for="title">Task Title</label>
          <input
            type="text"
            class="form-control"
            id="title"
            placeholder="Enter task title"
            required
          />
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea
            class="form-control"
            id="description"
            rows="3"
            placeholder="Enter task description"
            required
          ></textarea>
        </div>
        <div class="form-group">
          <label for="status">Status</label>
          <select class="form-control" id="status" required>
            <option value="pending">Pending</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        <div class="form-group">
          <label for="category">Category</label>
          <input
            type="text"
            class="form-control"
            id="category"
            placeholder="Enter task category"
            required
          />
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input type="date" class="form-control" id="dueDate" required />
        </div>
        <div class="form-group">
          <label for="userID">User ID</label>
          <input
            type="number"
            class="form-control"
            id="userID"
            placeholder="Enter user ID"
            required
          />
        </div>
        <button type="submit" class="btn btn-primary">Create Task</button>
      </form>
    </div>

    <script>
      document
        .getElementById("create-task-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const title = document.getElementById("title").value;
          const description = document.getElementById("description").value;
          const status = document.getElementById("status").value;
          const category = document.getElementById("category").value;
          const dueDate = document.getElementById("dueDate").value;
          const userID = document.getElementById("userID").value;
          const token = localStorage.getItem("token");
          if (!token) {
            alert("You are not authenticated. Please log in.");
            window.location.href = "/login-page";
            return;
          }
          if (
            !title ||
            !description ||
            !status ||
            !category ||
            !dueDate ||
            !userID
          ) {
            alert("Please fill in all required fields.");
            return;
          }

          // Gửi yêu cầu POST để tạo task mới
          fetch("/tasks", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + token,
            },
            body: JSON.stringify({
              title: title,
              description: description,
              status: status,
              category: category,
              due_date: dueDate,
              user_id: userID,
            }),
          })
            .then((response) => {
              if (!response.ok) {
                return response.json().then((errorData) => {
                  throw new Error(errorData.message || "Failed to create task");
                });
              }
              return response.json();
            })

            .then((data) => {
              if (data.id) {
                alert("Task created successfully!");
                setTimeout(() => {
                  window.location.href = "/tasks-page";
                }, 1500);
              } else {
                alert("Failed to create task");
              }
            })

            .catch((err) => {
              console.error("Error:", err);
              alert("There was an error creating the task. Please try again.");
            });
        });
    </script>
  </body>
</html>
